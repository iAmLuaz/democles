module.exports = async function (context, req) {
  try {
    context.log('HttpTrigger iniciado')

    const apiUrl = process.env.API_URL
    const useMock = process.env.USE_MOCK

    context.log('API_URL:', apiUrl)
    context.log('USE_MOCK:', useMock)

    if (!apiUrl) {
      context.res = {
        status: 500,
        headers: { 'Content-Type': 'application/json' },
        body: {
          ok: false,
          error: 'API_URL no configurada',
          env: {
            API_URL: apiUrl ?? null,
            USE_MOCK: useMock ?? null
          }
        }
      }
      return
    }

    context.res = {
      status: 200,
      headers: { 'Content-Type': 'application/json' },
      body: {
        ok: true,
        apiUrl,
        useMock
      }
    }
  } catch (err) {
    context.res = {
      status: 500,
      headers: { 'Content-Type': 'application/json' },
      body: {
        ok: false,
        error: err.message,
        stack: err.stack
      }
    }
  }
}
