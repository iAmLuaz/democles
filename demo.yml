export async function getSasUrl(filename: string) {
  console.log('[uploadService] filename:', filename)

  const url = `/api/httpTrigger2?filename=${encodeURIComponent(filename)}`
  console.log('[uploadService] fetch URL:', url)

  const res = await fetch(url)
  console.log('[uploadService] response status:', res.status)

  const text = await res.text()
  console.log('[uploadService] raw response:', text)

  if (!res.ok) {
    throw new Error('No se obtuvo el SAS')
  }

  return JSON.parse(text) as { uploadUrl: string }
}




async function upload() {
  if (!file.value) {
    error.value = 'Selecciona un archivo.'
    return
  }

  uploading.value = true
  error.value = null

  try {
    const selectedFile = file.value
    console.log('[Upload] file name:', selectedFile.name)

    const result = await getSasUrl(selectedFile.name)
    console.log('[Upload] SAS result:', result)

    console.log('[Upload] uploadUrl:', result.uploadUrl)

    success.value = true
  } catch (e) {
    console.error('[Upload] ERROR:', e)
    error.value = 'Error obteniendo SAS.'
  } finally {
    uploading.value = false
  }
}
