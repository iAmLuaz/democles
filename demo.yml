module.exports = async function (context, req) {
  const API_URL = process.env.API_URL
  const method = req.method.toUpperCase()
  const id = req.query.id

  if (!API_URL) {
    context.res = {
      status: 500,
      body: { error: 'API_URL no configurado' }
    }
    return
  }

  let url = `${API_URL}/consultar/clientes`

  if (method === 'GET' && id) {
    url = `${API_URL}/consultar/cliente/${id}`
  }

  context.log('Calling backend:', url)

  const res = await fetch(url)
  const data = await res.text()

  context.res = {
    status: res.status,
    headers: {
      'Content-Type': res.headers.get('content-type') ?? 'application/json',
      'Access-Control-Allow-Origin': '*'
    },
    body: data
  }
}
